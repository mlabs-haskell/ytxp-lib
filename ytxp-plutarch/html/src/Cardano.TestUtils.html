<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unrecognised-pragmas #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="annot"><span class="hs-comment">{- | Module: Cardano.TestUtils
Description: Construct nominal and attack test cases for unit tests

This module exposes a flexible way to generate test cases that go
through a pre-processing -&gt; pre-condition -&gt; execution -&gt; post-condition
pipeline.

The intention is to provide an easier interface to re-using predicates and pre-processors
between many tests and between different _kinds_ of tests, including nominal and attack
cases, as well as unit and property testing.

This module is currently targeted primarily at tests run on the CEK machine.
In the future, it may be expanded to be polymorphic in terms of arbitrary
&quot;computation&quot;. The current computation type is essentially hard-coded to

  (Maybe Datum, Redeemer, ScriptContext, Script) -&gt; (Either EvalError Script, ExBudget, Logs)

but this could be expanded so that other types of tests (emulator, integration, serialization,
golden) could be run as well.
-}</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.TestUtils</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Polymorphic Types and Functions</span></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** PreProcessing</span></span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier">PreProcessor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Construction</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#mkPreProcessor"><span class="hs-identifier">mkPreProcessor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Elimination</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#preProcess"><span class="hs-identifier">preProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** PreCondition Checking</span></span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PreCondition"><span class="hs-identifier">PreCondition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Construction</span></span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#mkPreCondition"><span class="hs-identifier">mkPreCondition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Elimination</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#checkPreConditions"><span class="hs-identifier">checkPreConditions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** PostCondition Checking</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier">PostCondition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Construction</span></span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#mkPostCondition"><span class="hs-identifier">mkPostCondition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Elimination</span></span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#checkPostConditions"><span class="hs-identifier">checkPostConditions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Test Cases</span></span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestCase"><span class="hs-identifier">PipelinedTestCase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestErrors"><span class="hs-identifier">PipelinedTestErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#pipelinedUnitCase"><span class="hs-identifier">pipelinedUnitCase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><span class="hs-comment">-- * TxFCEKMachinery</span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><span class="hs-comment">-- ** Generic TxF TestCase</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier">TxFCEKCase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier">TxFCEKInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier">TxFCEKOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#mkTxFCEKCase"><span class="hs-identifier">mkTxFCEKCase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#txfCEKUnitCase"><span class="hs-identifier">txfCEKUnitCase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Nominal Tests</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#nominalPostCondition"><span class="hs-identifier">nominalPostCondition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#nominalCaseBasic"><span class="hs-identifier">nominalCaseBasic</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="hs-comment">-- *** Attack Tests</span></span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#attackCaseRegexPostCondition"><span class="hs-identifier">attackCaseRegexPostCondition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#attackCaseBasicRegex"><span class="hs-identifier">attackCaseBasicRegex</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Arrow.html"><span class="hs-identifier">Control.Arrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Arrow.html#Kleisli"><span class="hs-identifier">Kleisli</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Arrow.html#Kleisli"><span class="hs-identifier">Kleisli</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Arrow.html#runKleisli"><span class="hs-identifier">runKleisli</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Category.html#%3E%3E%3E"><span class="hs-operator">(&gt;&gt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#fold"><span class="hs-identifier">fold</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#foldl%27"><span class="hs-identifier">foldl'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Kind.html"><span class="hs-identifier">Data.Kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Type"><span class="hs-identifier">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.OldList.html#intercalate"><span class="hs-identifier">intercalate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html"><span class="hs-identifier">Data.Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#First"><span class="hs-identifier">First</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#First"><span class="hs-identifier">First</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#getFirst"><span class="hs-identifier">getFirst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/text-2.0.2/src/Data.Text.html"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutarch.Evaluate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EvalError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">applyArguments</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalScriptHuge</span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutarch.Internal.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Script</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExBudget</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ScriptContext</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toData</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Tasty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TestTree</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Tasty.HUnit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assertFailure</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">testCase</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.RE.TDFA.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">RE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">countMatches</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">reSource</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(*=~)</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><span class="hs-comment">-- | PreProcessing -- could be used for normalization or attacks</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">newtype</span><span> </span><span id="PreProcessor"><span class="annot"><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier hs-var">PreProcessor</span></a></span></span><span> </span><span id="local-6989586621679223876"><span class="annot"><a href="#local-6989586621679223876"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621679223877"><span class="annot"><a href="#local-6989586621679223877"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PreProcessor"><span class="annot"><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier hs-var">PreProcessor</span></a></span></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3ApreProcessor%3APreProcessor"><span class="annot"><span class="annottext">forall err input.
PreProcessor err input -&gt; Kleisli (Either err) input input
</span><a href="Cardano.TestUtils.html#%24sel%3ApreProcessor%3APreProcessor"><span class="hs-identifier hs-var hs-var">preProcessor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Arrow.html#Kleisli"><span class="hs-identifier hs-type">Kleisli</span></a></span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223876"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><a href="#local-6989586621679223877"><span class="hs-identifier hs-type">input</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><a href="#local-6989586621679223877"><span class="hs-identifier hs-type">input</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span id="local-6989586621679223882"><span id="local-6989586621679223883"><span class="annot"><a href="Cardano.TestUtils.html#mkPreProcessor"><span class="hs-identifier hs-type">mkPreProcessor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679223882"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223883"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223882"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier hs-type">PreProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223883"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223882"><span class="hs-identifier hs-type">input</span></a></span></span></span><span>
</span><span id="line-103"></span><span id="mkPreProcessor"><span class="annot"><span class="annottext">mkPreProcessor :: forall input err.
(input -&gt; Either err input) -&gt; PreProcessor err input
</span><a href="Cardano.TestUtils.html#mkPreProcessor"><span class="hs-identifier hs-var hs-var">mkPreProcessor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kleisli (Either err) input input -&gt; PreProcessor err input
forall err input.
Kleisli (Either err) input input -&gt; PreProcessor err input
</span><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier hs-var">PreProcessor</span></a></span><span> </span><span class="annot"><span class="annottext">(Kleisli (Either err) input input -&gt; PreProcessor err input)
-&gt; ((input -&gt; Either err input)
    -&gt; Kleisli (Either err) input input)
-&gt; (input -&gt; Either err input)
-&gt; PreProcessor err input
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(input -&gt; Either err input) -&gt; Kleisli (Either err) input input
forall (m :: Type -&gt; Type) a b. (a -&gt; m b) -&gt; Kleisli m a b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Arrow.html#Kleisli"><span class="hs-identifier hs-var">Kleisli</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="annot"><span class="hs-comment">{- | Given a list of preprocessors, apply them in order from left to right.
Returns the first error encountered, if any.
-}</span></span><span>
</span><span id="line-108"></span><span id="local-6989586621679223892"><span id="local-6989586621679223893"><span class="annot"><a href="Cardano.TestUtils.html#preProcess"><span class="hs-identifier hs-type">preProcess</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier hs-type">PreProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223892"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223893"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="#local-6989586621679223893"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223892"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223893"><span class="hs-identifier hs-type">input</span></a></span></span></span><span>
</span><span id="line-112"></span><span id="preProcess"><span class="annot"><span class="annottext">preProcess :: forall err input.
[PreProcessor err input] -&gt; input -&gt; Either err input
</span><a href="Cardano.TestUtils.html#preProcess"><span class="hs-identifier hs-var hs-var">preProcess</span></a></span></span><span> </span><span id="local-6989586621679224213"><span class="annot"><span class="annottext">[PreProcessor err input]
</span><a href="#local-6989586621679224213"><span class="hs-identifier hs-var">pps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kleisli (Either err) input input -&gt; input -&gt; Either err input
forall (m :: Type -&gt; Type) a b. Kleisli m a b -&gt; a -&gt; m b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Arrow.html#runKleisli"><span class="hs-identifier hs-var">runKleisli</span></a></span><span> </span><span class="annot"><span class="annottext">(Kleisli (Either err) input input -&gt; input -&gt; Either err input)
-&gt; Kleisli (Either err) input input -&gt; input -&gt; Either err input
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Kleisli (Either err) input input
 -&gt; Kleisli (Either err) input input
 -&gt; Kleisli (Either err) input input)
-&gt; Kleisli (Either err) input input
-&gt; [Kleisli (Either err) input input]
-&gt; Kleisli (Either err) input input
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: Type -&gt; Type) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Kleisli (Either err) input input
-&gt; Kleisli (Either err) input input
-&gt; Kleisli (Either err) input input
forall {k} (cat :: k -&gt; k -&gt; Type) (a :: k) (b :: k) (c :: k).
Category @k cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Category.html#%3E%3E%3E"><span class="hs-operator hs-var">(&gt;&gt;&gt;)</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(input -&gt; Either err input) -&gt; Kleisli (Either err) input input
forall (m :: Type -&gt; Type) a b. (a -&gt; m b) -&gt; Kleisli m a b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Arrow.html#Kleisli"><span class="hs-identifier hs-var">Kleisli</span></a></span><span> </span><span class="annot"><span class="annottext">input -&gt; Either err input
forall a. a -&gt; Either err a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreProcessor err input -&gt; Kleisli (Either err) input input)
-&gt; [PreProcessor err input] -&gt; [Kleisli (Either err) input input]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">PreProcessor err input -&gt; Kleisli (Either err) input input
forall err input.
PreProcessor err input -&gt; Kleisli (Either err) input input
</span><a href="Cardano.TestUtils.html#%24sel%3ApreProcessor%3APreProcessor"><span class="hs-identifier hs-var">preProcessor</span></a></span><span> </span><span class="annot"><span class="annottext">[PreProcessor err input]
</span><a href="#local-6989586621679224213"><span class="hs-identifier hs-var">pps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><span class="hs-comment">{- | Checks for after the preprocessing is run. Could be used to check for
balancing, etc

TODO: rewrite as Kleisli?
-}</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">newtype</span><span> </span><span id="PreCondition"><span class="annot"><a href="Cardano.TestUtils.html#PreCondition"><span class="hs-identifier hs-var">PreCondition</span></a></span></span><span> </span><span id="local-6989586621679223919"><span class="annot"><a href="#local-6989586621679223919"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621679223920"><span class="annot"><a href="#local-6989586621679223920"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PreCondition"><span class="annot"><a href="Cardano.TestUtils.html#PreCondition"><span class="hs-identifier hs-var">PreCondition</span></a></span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3ApreCondition%3APreCondition"><span class="annot"><span class="annottext">forall err input. PreCondition err input -&gt; input -&gt; First err
</span><a href="Cardano.TestUtils.html#%24sel%3ApreCondition%3APreCondition"><span class="hs-identifier hs-var hs-var">preCondition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679223920"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#First"><span class="hs-identifier hs-type">First</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223919"><span class="hs-identifier hs-type">err</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span id="local-6989586621679223925"><span id="local-6989586621679223926"><span class="annot"><a href="Cardano.TestUtils.html#mkPreCondition"><span class="hs-identifier hs-type">mkPreCondition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679223925"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223926"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#PreCondition"><span class="hs-identifier hs-type">PreCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223926"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223925"><span class="hs-identifier hs-type">input</span></a></span></span></span><span>
</span><span id="line-126"></span><span id="mkPreCondition"><span class="annot"><span class="annottext">mkPreCondition :: forall input err. (input -&gt; Maybe err) -&gt; PreCondition err input
</span><a href="Cardano.TestUtils.html#mkPreCondition"><span class="hs-identifier hs-var hs-var">mkPreCondition</span></a></span></span><span> </span><span id="local-6989586621679224216"><span class="annot"><span class="annottext">input -&gt; Maybe err
</span><a href="#local-6989586621679224216"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(input -&gt; First err) -&gt; PreCondition err input
forall err input. (input -&gt; First err) -&gt; PreCondition err input
</span><a href="Cardano.TestUtils.html#PreCondition"><span class="hs-identifier hs-var">PreCondition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe err -&gt; First err
forall a. Maybe a -&gt; First a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#First"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe err -&gt; First err)
-&gt; (input -&gt; Maybe err) -&gt; input -&gt; First err
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">input -&gt; Maybe err
</span><a href="#local-6989586621679224216"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><span class="hs-comment">-- | Check a list of pre-conditions, returning the first error encountered</span></span><span>
</span><span id="line-129"></span><span id="local-6989586621679223930"><span id="local-6989586621679223931"><span class="annot"><a href="Cardano.TestUtils.html#checkPreConditions"><span class="hs-identifier hs-type">checkPreConditions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PreCondition"><span class="hs-identifier hs-type">PreCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223930"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223931"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="#local-6989586621679223931"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223930"><span class="hs-identifier hs-type">err</span></a></span></span></span><span>
</span><span id="line-133"></span><span id="checkPreConditions"><span class="annot"><span class="annottext">checkPreConditions :: forall err input. [PreCondition err input] -&gt; input -&gt; Maybe err
</span><a href="Cardano.TestUtils.html#checkPreConditions"><span class="hs-identifier hs-var hs-var">checkPreConditions</span></a></span></span><span> </span><span id="local-6989586621679224220"><span class="annot"><span class="annottext">[PreCondition err input]
</span><a href="#local-6989586621679224220"><span class="hs-identifier hs-var">pcs</span></a></span></span><span> </span><span id="local-6989586621679224221"><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679224221"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><span class="annottext">First err -&gt; Maybe err
forall a. First a -&gt; Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#getFirst"><span class="hs-identifier hs-var">getFirst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PreCondition err input -&gt; First err)
-&gt; [PreCondition err input] -&gt; First err
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: Type -&gt; Type) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679224223"><span class="annot"><span class="annottext">input -&gt; First err
</span><a href="#local-6989586621679224223"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">input -&gt; First err
</span><a href="#local-6989586621679224223"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679224221"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((input -&gt; First err) -&gt; First err)
-&gt; (PreCondition err input -&gt; input -&gt; First err)
-&gt; PreCondition err input
-&gt; First err
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PreCondition err input -&gt; input -&gt; First err
forall err input. PreCondition err input -&gt; input -&gt; First err
</span><a href="Cardano.TestUtils.html#%24sel%3ApreCondition%3APreCondition"><span class="hs-identifier hs-var">preCondition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PreCondition err input]
</span><a href="#local-6989586621679224220"><span class="hs-identifier hs-var">pcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><span class="hs-comment">{- | Represents a partial post-condition predicate on the result of
a call to `evalScript :: Script -&gt; (Either EvalError Script, ExBudget, [Text]) `
TODO: Rewrite as Kleisli?

TODO: If its possible to turn budgeting off, we should. These scripts
will be run with some logging output, and they wouldn't in production; thus
costing is not actually representative of anything useful.
-}</span></span><span>
</span><span id="line-146"></span><span class="hs-keyword">newtype</span><span> </span><span id="PostCondition"><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-var">PostCondition</span></a></span></span><span> </span><span id="local-6989586621679223938"><span class="annot"><a href="#local-6989586621679223938"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621679223939"><span class="annot"><a href="#local-6989586621679223939"><span class="hs-identifier hs-type">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PostCondition"><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-var">PostCondition</span></a></span></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-special">{</span><span id="%24sel%3ApostCondition%3APostCondition"><span class="annot"><span class="annottext">forall err output. PostCondition err output -&gt; output -&gt; First err
</span><a href="Cardano.TestUtils.html#%24sel%3ApostCondition%3APostCondition"><span class="hs-identifier hs-var hs-var">postCondition</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679223939"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#First"><span class="hs-identifier hs-type">First</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223938"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span id="local-6989586621679223943"><span id="local-6989586621679223944"><span class="annot"><a href="Cardano.TestUtils.html#mkPostCondition"><span class="hs-identifier hs-type">mkPostCondition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679223943"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223944"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-type">PostCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223944"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223943"><span class="hs-identifier hs-type">output</span></a></span></span></span><span>
</span><span id="line-150"></span><span id="mkPostCondition"><span class="annot"><span class="annottext">mkPostCondition :: forall output err.
(output -&gt; Maybe err) -&gt; PostCondition err output
</span><a href="Cardano.TestUtils.html#mkPostCondition"><span class="hs-identifier hs-var hs-var">mkPostCondition</span></a></span></span><span> </span><span id="local-6989586621679224226"><span class="annot"><span class="annottext">output -&gt; Maybe err
</span><a href="#local-6989586621679224226"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(output -&gt; First err) -&gt; PostCondition err output
forall err output.
(output -&gt; First err) -&gt; PostCondition err output
</span><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-var">PostCondition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe err -&gt; First err
forall a. Maybe a -&gt; First a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#First"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe err -&gt; First err)
-&gt; (output -&gt; Maybe err) -&gt; output -&gt; First err
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">output -&gt; Maybe err
</span><a href="#local-6989586621679224226"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">{- | Check a list of post-conditions from left to right, returning the first
error encountered
-}</span></span><span>
</span><span id="line-155"></span><span id="local-6989586621679223947"><span id="local-6989586621679223948"><span class="annot"><a href="Cardano.TestUtils.html#checkPostConditions"><span class="hs-identifier hs-type">checkPostConditions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-type">PostCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223947"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223948"><span class="hs-identifier hs-type">output</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="#local-6989586621679223948"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223947"><span class="hs-identifier hs-type">err</span></a></span></span></span><span>
</span><span id="line-159"></span><span id="checkPostConditions"><span class="annot"><span class="annottext">checkPostConditions :: forall err output.
[PostCondition err output] -&gt; output -&gt; Maybe err
</span><a href="Cardano.TestUtils.html#checkPostConditions"><span class="hs-identifier hs-var hs-var">checkPostConditions</span></a></span></span><span> </span><span id="local-6989586621679224229"><span class="annot"><span class="annottext">[PostCondition err output]
</span><a href="#local-6989586621679224229"><span class="hs-identifier hs-var">pcs</span></a></span></span><span> </span><span id="local-6989586621679224230"><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679224230"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="annottext">First err -&gt; Maybe err
forall a. First a -&gt; Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Monoid.html#getFirst"><span class="hs-identifier hs-var">getFirst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PostCondition err output -&gt; First err)
-&gt; [PostCondition err output] -&gt; First err
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: Type -&gt; Type) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679224231"><span class="annot"><span class="annottext">output -&gt; First err
</span><a href="#local-6989586621679224231"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">output -&gt; First err
</span><a href="#local-6989586621679224231"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679224230"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((output -&gt; First err) -&gt; First err)
-&gt; (PostCondition err output -&gt; output -&gt; First err)
-&gt; PostCondition err output
-&gt; First err
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PostCondition err output -&gt; output -&gt; First err
forall err output. PostCondition err output -&gt; output -&gt; First err
</span><a href="Cardano.TestUtils.html#%24sel%3ApostCondition%3APostCondition"><span class="hs-identifier hs-var">postCondition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PostCondition err output]
</span><a href="#local-6989586621679224229"><span class="hs-identifier hs-var">pcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="annot"><span class="hs-comment">{- | A type representing a named test case for a transaction family.
NOTE: if the `sc-tools` work ends up panning out, the `args` and `script` arguments
might get combined to a (Maybe Datum, Redeemer, ScriptContext, Script)
-}</span></span><span>
</span><span id="line-168"></span><span class="hs-keyword">data</span><span> </span><span id="PipelinedTestCase"><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestCase"><span class="hs-identifier hs-var">PipelinedTestCase</span></a></span></span><span> </span><span id="local-6989586621679223951"><span class="annot"><a href="#local-6989586621679223951"><span class="hs-identifier hs-type">errPP</span></a></span></span><span> </span><span id="local-6989586621679223952"><span class="annot"><a href="#local-6989586621679223952"><span class="hs-identifier hs-type">errPreC</span></a></span></span><span> </span><span id="local-6989586621679223953"><span class="annot"><a href="#local-6989586621679223953"><span class="hs-identifier hs-type">errPostC</span></a></span></span><span> </span><span id="local-6989586621679223954"><span class="annot"><a href="#local-6989586621679223954"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621679223955"><span class="annot"><a href="#local-6989586621679223955"><span class="hs-identifier hs-type">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PipelinedTestCase"><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestCase"><span class="hs-identifier hs-var">PipelinedTestCase</span></a></span></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aname%3APipelinedTestCase"><span class="annot"><span class="annottext">forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output -&gt; String
</span><a href="Cardano.TestUtils.html#%24sel%3Aname%3APipelinedTestCase"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Name of the test case</span></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3ApreProcessors%3APipelinedTestCase"><span class="annot"><span class="annottext">forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output
-&gt; [PreProcessor errPP input]
</span><a href="Cardano.TestUtils.html#%24sel%3ApreProcessors%3APipelinedTestCase"><span class="hs-identifier hs-var hs-var">preProcessors</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier hs-type">PreProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223951"><span class="hs-identifier hs-type">errPP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223954"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Pre-processors (normalizers or attacks); applied in order from left to right</span></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3ApreConditions%3APipelinedTestCase"><span class="annot"><span class="annottext">forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output
-&gt; [PreCondition errPreC input]
</span><a href="Cardano.TestUtils.html#%24sel%3ApreConditions%3APipelinedTestCase"><span class="hs-identifier hs-var hs-var">preConditions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PreCondition"><span class="hs-identifier hs-type">PreCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223952"><span class="hs-identifier hs-type">errPreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223954"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Pre-condition Checking. Run after pre-processing</span></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Ainput%3APipelinedTestCase"><span class="annot"><span class="annottext">forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output -&gt; input
</span><a href="Cardano.TestUtils.html#%24sel%3Ainput%3APipelinedTestCase"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679223954"><span class="hs-identifier hs-type">input</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the input to the computation</span></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acomputation%3APipelinedTestCase"><span class="annot"><span class="annottext">forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output
-&gt; input -&gt; output
</span><a href="Cardano.TestUtils.html#%24sel%3Acomputation%3APipelinedTestCase"><span class="hs-identifier hs-var hs-var">computation</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679223954"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679223955"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the computation to run</span></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3ApostConditions%3APipelinedTestCase"><span class="annot"><span class="annottext">forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output
-&gt; [PostCondition errPostC output]
</span><a href="Cardano.TestUtils.html#%24sel%3ApostConditions%3APipelinedTestCase"><span class="hs-identifier hs-var hs-var">postConditions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-type">PostCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223953"><span class="hs-identifier hs-type">errPostC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223955"><span class="hs-identifier hs-type">output</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Post conditions are checked after script execution</span></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><span class="hs-comment">-- | A sum type to collect the errors of a pipelined test case</span></span><span>
</span><span id="line-184"></span><span class="hs-keyword">data</span><span> </span><span id="PipelinedTestErrors"><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestErrors"><span class="hs-identifier hs-var">PipelinedTestErrors</span></a></span></span><span> </span><span id="local-6989586621679224239"><span class="annot"><a href="#local-6989586621679224239"><span class="hs-identifier hs-type">errPP</span></a></span></span><span> </span><span id="local-6989586621679224240"><span class="annot"><a href="#local-6989586621679224240"><span class="hs-identifier hs-type">errPreC</span></a></span></span><span> </span><span id="local-6989586621679224241"><span class="annot"><a href="#local-6989586621679224241"><span class="hs-identifier hs-type">errPostC</span></a></span></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="PipelinedPreProcessorError"><span class="annot"><a href="Cardano.TestUtils.html#PipelinedPreProcessorError"><span class="hs-identifier hs-var">PipelinedPreProcessorError</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679224239"><span class="hs-identifier hs-type">errPP</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PipelinedPreConditionError"><span class="annot"><a href="Cardano.TestUtils.html#PipelinedPreConditionError"><span class="hs-identifier hs-var">PipelinedPreConditionError</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679224240"><span class="hs-identifier hs-type">errPreC</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PipelinedPostConditionError"><span class="annot"><a href="Cardano.TestUtils.html#PipelinedPostConditionError"><span class="hs-identifier hs-var">PipelinedPostConditionError</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679224241"><span class="hs-identifier hs-type">errPostC</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><span class="hs-comment">{- | Behavior of this function:

- 1.) All pre-processors are run in order from left to right on the arguments.
  If any pre-processor returns a Left, then the resulting test case fails with
  the appropriate error message.
- 2.) All pre-condition checks are run on the pre-processed arguments.
  If any pre-condition checks return Nothing, then the resulting test case fails
  with the appropriate error message.
- 3.) The pre-processed arguments are fed to the script.
- 4.) The results of (3) are checked against each post-condition.
  If any of the post-condition checks fail, the test case fails with the appropriate
  error message
- 5.) If none of the above checks cause a failure, the test succeeds.
-}</span></span><span>
</span><span id="line-203"></span><span id="local-6989586621679223987"><span id="local-6989586621679223988"><span id="local-6989586621679223989"><span id="local-6989586621679223990"><span id="local-6989586621679223991"><span class="annot"><a href="Cardano.TestUtils.html#pipelinedUnitCase"><span class="hs-identifier hs-type">pipelinedUnitCase</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223987"><span class="hs-identifier hs-type">errPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223988"><span class="hs-identifier hs-type">errPreC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223989"><span class="hs-identifier hs-type">errPostC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestCase"><span class="hs-identifier hs-type">PipelinedTestCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223987"><span class="hs-identifier hs-type">errPP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223988"><span class="hs-identifier hs-type">errPreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223989"><span class="hs-identifier hs-type">errPostC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223990"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679223991"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span></span></span></span></span></span><span>
</span><span id="line-207"></span><span id="pipelinedUnitCase"><span class="annot"><span class="annottext">pipelinedUnitCase :: forall errPP errPreC errPostC input output.
(Show errPP, Show errPreC, Show errPostC) =&gt;
PipelinedTestCase errPP errPreC errPostC input output -&gt; TestTree
</span><a href="Cardano.TestUtils.html#pipelinedUnitCase"><span class="hs-identifier hs-var hs-var">pipelinedUnitCase</span></a></span></span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestCase"><span class="hs-identifier hs-type">PipelinedTestCase</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:name:PipelinedTestCase :: forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output -&gt; String
</span><a href="Cardano.TestUtils.html#%24sel%3Aname%3APipelinedTestCase"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679224259"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679224259"><span class="hs-identifier hs-var">name'</span></a></span></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:preProcessors:PipelinedTestCase :: forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output
-&gt; [PreProcessor errPP input]
</span><a href="Cardano.TestUtils.html#%24sel%3ApreProcessors%3APipelinedTestCase"><span class="hs-identifier hs-var">preProcessors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679224260"><span class="annot"><span class="annottext">[PreProcessor errPP input]
</span><a href="#local-6989586621679224260"><span class="hs-identifier hs-var">preProcessors'</span></a></span></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:preConditions:PipelinedTestCase :: forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output
-&gt; [PreCondition errPreC input]
</span><a href="Cardano.TestUtils.html#%24sel%3ApreConditions%3APipelinedTestCase"><span class="hs-identifier hs-var">preConditions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679224261"><span class="annot"><span class="annottext">[PreCondition errPreC input]
</span><a href="#local-6989586621679224261"><span class="hs-identifier hs-var">preConditions'</span></a></span></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:input:PipelinedTestCase :: forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output -&gt; input
</span><a href="Cardano.TestUtils.html#%24sel%3Ainput%3APipelinedTestCase"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679224262"><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679224262"><span class="hs-identifier hs-var">input'</span></a></span></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:computation:PipelinedTestCase :: forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output
-&gt; input -&gt; output
</span><a href="Cardano.TestUtils.html#%24sel%3Acomputation%3APipelinedTestCase"><span class="hs-identifier hs-var">computation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679224263"><span class="annot"><span class="annottext">input -&gt; output
</span><a href="#local-6989586621679224263"><span class="hs-identifier hs-var">computation'</span></a></span></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:postConditions:PipelinedTestCase :: forall errPP errPreC errPostC input output.
PipelinedTestCase errPP errPreC errPostC input output
-&gt; [PostCondition errPostC output]
</span><a href="Cardano.TestUtils.html#%24sel%3ApostConditions%3APipelinedTestCase"><span class="hs-identifier hs-var">postConditions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679224264"><span class="annot"><span class="annottext">[PostCondition errPostC output]
</span><a href="#local-6989586621679224264"><span class="hs-identifier hs-var">postConditions'</span></a></span></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Assertion -&gt; TestTree
</span><span class="hs-identifier hs-var">testCase</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679224259"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">(Assertion -&gt; TestTree) -&gt; Assertion -&gt; TestTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>      </span><span class="hs-comment">-- Run preprocessing</span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[PreProcessor errPP input] -&gt; input -&gt; Either errPP input
forall err input.
[PreProcessor err input] -&gt; input -&gt; Either err input
</span><a href="Cardano.TestUtils.html#preProcess"><span class="hs-identifier hs-var">preProcess</span></a></span><span> </span><span class="annot"><span class="annottext">[PreProcessor errPP input]
</span><a href="#local-6989586621679224260"><span class="hs-identifier hs-var">preProcessors'</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679224262"><span class="hs-identifier hs-var">input'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>        </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679224265"><span class="annot"><span class="annottext">errPP
</span><a href="#local-6989586621679224265"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Assertion
forall a. HasCallStack =&gt; String -&gt; IO a
</span><span class="hs-identifier hs-var">assertFailure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Assertion) -&gt; String -&gt; Assertion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">errPP -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">errPP
</span><a href="#local-6989586621679224265"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679224267"><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679224267"><span class="hs-identifier hs-var">preProcessedArgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>          </span><span class="hs-comment">-- Run pre-condition  checks</span><span>
</span><span id="line-222"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[PreCondition errPreC input] -&gt; input -&gt; Maybe errPreC
forall err input. [PreCondition err input] -&gt; input -&gt; Maybe err
</span><a href="Cardano.TestUtils.html#checkPreConditions"><span class="hs-identifier hs-var">checkPreConditions</span></a></span><span> </span><span class="annot"><span class="annottext">[PreCondition errPreC input]
</span><a href="#local-6989586621679224261"><span class="hs-identifier hs-var">preConditions'</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679224267"><span class="hs-identifier hs-var">preProcessedArgs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679224268"><span class="annot"><span class="annottext">errPreC
</span><a href="#local-6989586621679224268"><span class="hs-identifier hs-var">err'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Assertion
forall a. HasCallStack =&gt; String -&gt; IO a
</span><span class="hs-identifier hs-var">assertFailure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Assertion) -&gt; String -&gt; Assertion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">errPreC -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">errPreC
</span><a href="#local-6989586621679224268"><span class="hs-identifier hs-var">err'</span></a></span><span>
</span><span id="line-224"></span><span>            </span><span class="annot"><span class="annottext">Maybe errPreC
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-225"></span><span>              </span><span class="hs-comment">-- Run computation</span><span>
</span><span id="line-226"></span><span>              </span><span class="hs-keyword">let</span><span>
</span><span id="line-227"></span><span>                </span><span id="local-6989586621679224269"><span class="annot"><span class="annottext">evaluationResult :: output
</span><a href="#local-6989586621679224269"><span class="hs-identifier hs-var hs-var">evaluationResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-228"></span><span>                  </span><span class="annot"><span class="annottext">input -&gt; output
</span><a href="#local-6989586621679224263"><span class="hs-identifier hs-var">computation'</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679224267"><span class="hs-identifier hs-var">preProcessedArgs</span></a></span><span>
</span><span id="line-229"></span><span>               </span><span class="hs-keyword">in</span><span>
</span><span id="line-230"></span><span>                </span><span class="hs-comment">-- Run post condition checks</span><span>
</span><span id="line-231"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[PostCondition errPostC output] -&gt; output -&gt; Maybe errPostC
forall err output.
[PostCondition err output] -&gt; output -&gt; Maybe err
</span><a href="Cardano.TestUtils.html#checkPostConditions"><span class="hs-identifier hs-var">checkPostConditions</span></a></span><span> </span><span class="annot"><span class="annottext">[PostCondition errPostC output]
</span><a href="#local-6989586621679224264"><span class="hs-identifier hs-var">postConditions'</span></a></span><span> </span><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679224269"><span class="hs-identifier hs-var">evaluationResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-232"></span><span>                  </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679224270"><span class="annot"><span class="annottext">errPostC
</span><a href="#local-6989586621679224270"><span class="hs-identifier hs-var">err''</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Assertion
forall a. HasCallStack =&gt; String -&gt; IO a
</span><span class="hs-identifier hs-var">assertFailure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Assertion) -&gt; String -&gt; Assertion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">errPostC -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">errPostC
</span><a href="#local-6989586621679224270"><span class="hs-identifier hs-var">err''</span></a></span><span>
</span><span id="line-233"></span><span>                  </span><span class="annot"><span class="annottext">Maybe errPostC
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Assertion
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><span class="hs-comment">-- * TxF CEK Machinery</span></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><span class="hs-comment">{- | The arguments needed to run a YTxP-style transaction family (single script)
on the CEK Machine. Includes a script context, and the script itself.
-}</span></span><span>
</span><span id="line-242"></span><span class="hs-keyword">data</span><span> </span><span id="TxFCEKInput"><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-var">TxFCEKInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TxFCEKInput"><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-var">TxFCEKInput</span></a></span></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcekScriptContext%3ATxFCEKInput"><span class="annot"><span class="annottext">TxFCEKInput -&gt; ScriptContext
</span><a href="Cardano.TestUtils.html#%24sel%3AcekScriptContext%3ATxFCEKInput"><span class="hs-identifier hs-var hs-var">cekScriptContext</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcekScript%3ATxFCEKInput"><span class="annot"><span class="annottext">TxFCEKInput -&gt; Script
</span><a href="Cardano.TestUtils.html#%24sel%3AcekScript%3ATxFCEKInput"><span class="hs-identifier hs-var hs-var">cekScript</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script</span></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224275"><span id="local-6989586621679224281"><span class="annot"><span class="annottext">TxFCEKInput -&gt; TxFCEKInput -&gt; Bool
(TxFCEKInput -&gt; TxFCEKInput -&gt; Bool)
-&gt; (TxFCEKInput -&gt; TxFCEKInput -&gt; Bool) -&gt; Eq TxFCEKInput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: TxFCEKInput -&gt; TxFCEKInput -&gt; Bool
== :: TxFCEKInput -&gt; TxFCEKInput -&gt; Bool
$c/= :: TxFCEKInput -&gt; TxFCEKInput -&gt; Bool
/= :: TxFCEKInput -&gt; TxFCEKInput -&gt; Bool
</span><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679224286"><span id="local-6989586621679224294"><span id="local-6989586621679224298"><span class="annot"><span class="annottext">Int -&gt; TxFCEKInput -&gt; ShowS
[TxFCEKInput] -&gt; ShowS
TxFCEKInput -&gt; String
(Int -&gt; TxFCEKInput -&gt; ShowS)
-&gt; (TxFCEKInput -&gt; String)
-&gt; ([TxFCEKInput] -&gt; ShowS)
-&gt; Show TxFCEKInput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TxFCEKInput -&gt; ShowS
showsPrec :: Int -&gt; TxFCEKInput -&gt; ShowS
$cshow :: TxFCEKInput -&gt; String
show :: TxFCEKInput -&gt; String
$cshowList :: [TxFCEKInput] -&gt; ShowS
showList :: [TxFCEKInput] -&gt; ShowS
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="annot"><span class="hs-comment">-- | The data produced by the CEK machine when run against a TxFCEKInput.</span></span><span>
</span><span id="line-249"></span><span class="hs-keyword">data</span><span> </span><span id="TxFCEKOutput"><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-var">TxFCEKOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TxFCEKOutput"><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-var">TxFCEKOutput</span></a></span></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcekResult%3ATxFCEKOutput"><span class="annot"><span class="annottext">TxFCEKOutput -&gt; Either EvalError Script
</span><a href="Cardano.TestUtils.html#%24sel%3AcekResult%3ATxFCEKOutput"><span class="hs-identifier hs-var hs-var">cekResult</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvalError</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script</span></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcekExBudget%3ATxFCEKOutput"><span class="annot"><span class="annottext">TxFCEKOutput -&gt; ExBudget
</span><a href="Cardano.TestUtils.html#%24sel%3AcekExBudget%3ATxFCEKOutput"><span class="hs-identifier hs-var hs-var">cekExBudget</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ExBudget</span></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcekLogs%3ATxFCEKOutput"><span class="annot"><span class="annottext">TxFCEKOutput -&gt; [Text]
</span><a href="Cardano.TestUtils.html#%24sel%3AcekLogs%3ATxFCEKOutput"><span class="hs-identifier hs-var hs-var">cekLogs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224306"><span id="local-6989586621679224317"><span class="annot"><span class="annottext">TxFCEKOutput -&gt; TxFCEKOutput -&gt; Bool
(TxFCEKOutput -&gt; TxFCEKOutput -&gt; Bool)
-&gt; (TxFCEKOutput -&gt; TxFCEKOutput -&gt; Bool) -&gt; Eq TxFCEKOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: TxFCEKOutput -&gt; TxFCEKOutput -&gt; Bool
== :: TxFCEKOutput -&gt; TxFCEKOutput -&gt; Bool
$c/= :: TxFCEKOutput -&gt; TxFCEKOutput -&gt; Bool
/= :: TxFCEKOutput -&gt; TxFCEKOutput -&gt; Bool
</span><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679224367"><span id="local-6989586621679224377"><span id="local-6989586621679224381"><span class="annot"><span class="annottext">Int -&gt; TxFCEKOutput -&gt; ShowS
[TxFCEKOutput] -&gt; ShowS
TxFCEKOutput -&gt; String
(Int -&gt; TxFCEKOutput -&gt; ShowS)
-&gt; (TxFCEKOutput -&gt; String)
-&gt; ([TxFCEKOutput] -&gt; ShowS)
-&gt; Show TxFCEKOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TxFCEKOutput -&gt; ShowS
showsPrec :: Int -&gt; TxFCEKOutput -&gt; ShowS
$cshow :: TxFCEKOutput -&gt; String
show :: TxFCEKOutput -&gt; String
$cshowList :: [TxFCEKOutput] -&gt; ShowS
showList :: [TxFCEKOutput] -&gt; ShowS
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="annot"><span class="hs-comment">-- | A sum type of the errors for a TxFCEKCase</span></span><span>
</span><span id="line-257"></span><span class="hs-keyword">newtype</span><span> </span><span id="TxFCEKCase"><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier hs-var">TxFCEKCase</span></a></span></span><span> </span><span id="local-6989586621679224032"><span class="annot"><a href="#local-6989586621679224032"><span class="hs-identifier hs-type">errPP</span></a></span></span><span> </span><span id="local-6989586621679224033"><span class="annot"><a href="#local-6989586621679224033"><span class="hs-identifier hs-type">errPreC</span></a></span></span><span> </span><span id="local-6989586621679224034"><span class="annot"><a href="#local-6989586621679224034"><span class="hs-identifier hs-type">errPostC</span></a></span></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TxFCEKCase"><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier hs-var">TxFCEKCase</span></a></span></span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestCase"><span class="hs-identifier hs-type">PipelinedTestCase</span></a></span><span>
</span><span id="line-260"></span><span>          </span><span class="annot"><a href="#local-6989586621679224032"><span class="hs-identifier hs-type">errPP</span></a></span><span>
</span><span id="line-261"></span><span>          </span><span class="annot"><a href="#local-6989586621679224033"><span class="hs-identifier hs-type">errPreC</span></a></span><span>
</span><span id="line-262"></span><span>          </span><span class="annot"><a href="#local-6989586621679224034"><span class="hs-identifier hs-type">errPostC</span></a></span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-type">TxFCEKInput</span></a></span><span>
</span><span id="line-264"></span><span>          </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-type">TxFCEKOutput</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><span class="hs-comment">-- | Create a TxFCEKCase by filling in the computation via running the script.</span></span><span>
</span><span id="line-268"></span><span class="annot"><a href="Cardano.TestUtils.html#mkTxFCEKCase"><span class="hs-identifier hs-type">mkTxFCEKCase</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224024"><span class="annot"><a href="#local-6989586621679224024"><span class="hs-identifier hs-type">errPP</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224025"><span class="annot"><a href="#local-6989586621679224025"><span class="hs-identifier hs-type">errPreC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224026"><span class="annot"><a href="#local-6989586621679224026"><span class="hs-identifier hs-type">errPostC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Name of the test case</span></span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="hs-comment">-- | List of pre-processors over something like (Maybe Datum, Redeemer, ScriptContext, Script)</span></span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier hs-type">PreProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224024"><span class="hs-identifier hs-type">errPP</span></a></span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-type">TxFCEKInput</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="hs-comment">-- | List of pre-condition checks over something like (Maybe Datum, Redeemer, ScriptContext, Script)</span></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PreCondition"><span class="hs-identifier hs-type">PreCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224025"><span class="hs-identifier hs-type">errPreC</span></a></span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-type">TxFCEKInput</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Something like (Maybe Datum, Redeemer, ScriptContext, Script)</span></span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-type">TxFCEKInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Post-conditions over something like (Either EvalError Script, ExBudget, [Text])</span></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-type">PostCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224026"><span class="hs-identifier hs-type">errPostC</span></a></span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-type">TxFCEKOutput</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier hs-type">TxFCEKCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224024"><span class="hs-identifier hs-type">errPP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224025"><span class="hs-identifier hs-type">errPreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224026"><span class="hs-identifier hs-type">errPostC</span></a></span><span>
</span><span id="line-281"></span><span id="mkTxFCEKCase"><span class="annot"><span class="annottext">mkTxFCEKCase :: forall errPP errPreC errPostC.
String
-&gt; [PreProcessor errPP TxFCEKInput]
-&gt; [PreCondition errPreC TxFCEKInput]
-&gt; TxFCEKInput
-&gt; [PostCondition errPostC TxFCEKOutput]
-&gt; TxFCEKCase errPP errPreC errPostC
</span><a href="Cardano.TestUtils.html#mkTxFCEKCase"><span class="hs-identifier hs-var hs-var">mkTxFCEKCase</span></a></span></span><span> </span><span id="local-6989586621679224386"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679224386"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span id="local-6989586621679224387"><span class="annot"><span class="annottext">[PreProcessor errPP TxFCEKInput]
</span><a href="#local-6989586621679224387"><span class="hs-identifier hs-var">pps</span></a></span></span><span> </span><span id="local-6989586621679224388"><span class="annot"><span class="annottext">[PreCondition errPreC TxFCEKInput]
</span><a href="#local-6989586621679224388"><span class="hs-identifier hs-var">preCs</span></a></span></span><span> </span><span id="local-6989586621679224389"><span class="annot"><span class="annottext">TxFCEKInput
</span><a href="#local-6989586621679224389"><span class="hs-identifier hs-var">input'</span></a></span></span><span> </span><span id="local-6989586621679224390"><span class="annot"><span class="annottext">[PostCondition errPostC TxFCEKOutput]
</span><a href="#local-6989586621679224390"><span class="hs-identifier hs-var">postCs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><span class="annottext">PipelinedTestCase errPP errPreC errPostC TxFCEKInput TxFCEKOutput
-&gt; TxFCEKCase errPP errPreC errPostC
forall errPP errPreC errPostC.
PipelinedTestCase errPP errPreC errPostC TxFCEKInput TxFCEKOutput
-&gt; TxFCEKCase errPP errPreC errPostC
</span><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier hs-var">TxFCEKCase</span></a></span><span> </span><span class="annot"><span class="annottext">(PipelinedTestCase errPP errPreC errPostC TxFCEKInput TxFCEKOutput
 -&gt; TxFCEKCase errPP errPreC errPostC)
-&gt; PipelinedTestCase
     errPP errPreC errPostC TxFCEKInput TxFCEKOutput
-&gt; TxFCEKCase errPP errPreC errPostC
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><a href="Cardano.TestUtils.html#PipelinedTestCase"><span class="hs-identifier hs-type">PipelinedTestCase</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:name:PipelinedTestCase :: String
</span><a href="Cardano.TestUtils.html#%24sel%3Aname%3APipelinedTestCase"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679224386"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:preProcessors:PipelinedTestCase :: [PreProcessor errPP TxFCEKInput]
</span><a href="Cardano.TestUtils.html#%24sel%3ApreProcessors%3APipelinedTestCase"><span class="hs-identifier hs-var">preProcessors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PreProcessor errPP TxFCEKInput]
</span><a href="#local-6989586621679224387"><span class="hs-identifier hs-var">pps</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:preConditions:PipelinedTestCase :: [PreCondition errPreC TxFCEKInput]
</span><a href="Cardano.TestUtils.html#%24sel%3ApreConditions%3APipelinedTestCase"><span class="hs-identifier hs-var">preConditions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PreCondition errPreC TxFCEKInput]
</span><a href="#local-6989586621679224388"><span class="hs-identifier hs-var">preCs</span></a></span><span>
</span><span id="line-287"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:input:PipelinedTestCase :: TxFCEKInput
</span><a href="Cardano.TestUtils.html#%24sel%3Ainput%3APipelinedTestCase"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxFCEKInput
</span><a href="#local-6989586621679224389"><span class="hs-identifier hs-var">input'</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:computation:PipelinedTestCase :: TxFCEKInput -&gt; TxFCEKOutput
</span><a href="Cardano.TestUtils.html#%24sel%3Acomputation%3APipelinedTestCase"><span class="hs-identifier hs-var">computation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxFCEKInput -&gt; TxFCEKOutput
</span><a href="#local-6989586621679224391"><span class="hs-identifier hs-var">comp</span></a></span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:postConditions:PipelinedTestCase :: [PostCondition errPostC TxFCEKOutput]
</span><a href="Cardano.TestUtils.html#%24sel%3ApostConditions%3APipelinedTestCase"><span class="hs-identifier hs-var">postConditions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PostCondition errPostC TxFCEKOutput]
</span><a href="#local-6989586621679224390"><span class="hs-identifier hs-var">postCs</span></a></span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><a href="#local-6989586621679224391"><span class="hs-identifier hs-type">comp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-type">TxFCEKInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-type">TxFCEKOutput</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621679224391"><span class="annot"><span class="annottext">comp :: TxFCEKInput -&gt; TxFCEKOutput
</span><a href="#local-6989586621679224391"><span class="hs-identifier hs-var hs-var">comp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-type">TxFCEKInput</span></a></span><span> </span><span id="local-6989586621679224392"><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679224392"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621679224393"><span class="annot"><span class="annottext">Script
</span><a href="#local-6989586621679224393"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679224394"><span class="annot"><span class="annottext">Either EvalError Script
</span><a href="#local-6989586621679224394"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679224395"><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679224395"><span class="hs-identifier hs-var">budget</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679224396"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224396"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Script -&gt; (Either EvalError Script, ExBudget, [Text])
</span><span class="hs-identifier hs-var">evalScriptHuge</span></span><span> </span><span class="annot"><span class="annottext">(Script -&gt; (Either EvalError Script, ExBudget, [Text]))
-&gt; ([Data] -&gt; Script)
-&gt; [Data]
-&gt; (Either EvalError Script, ExBudget, [Text])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Script -&gt; [Data] -&gt; Script
</span><span class="hs-identifier hs-var">applyArguments</span></span><span> </span><span class="annot"><span class="annottext">Script
</span><a href="#local-6989586621679224393"><span class="hs-identifier hs-var">script</span></a></span><span> </span><span class="annot"><span class="annottext">([Data] -&gt; (Either EvalError Script, ExBudget, [Text]))
-&gt; [Data] -&gt; (Either EvalError Script, ExBudget, [Text])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ScriptContext -&gt; Data
forall a. ToData a =&gt; a -&gt; Data
</span><span class="hs-identifier hs-var">toData</span></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679224392"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-296"></span><span>       </span><span class="hs-keyword">in</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">Either EvalError Script -&gt; ExBudget -&gt; [Text] -&gt; TxFCEKOutput
</span><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-var">TxFCEKOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Either EvalError Script
</span><a href="#local-6989586621679224394"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679224395"><span class="hs-identifier hs-var">budget</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224396"><span class="hs-identifier hs-var">logs</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Cardano.TestUtils.html#txfCEKUnitCase"><span class="hs-identifier hs-type">txfCEKUnitCase</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224036"><span class="annot"><a href="#local-6989586621679224036"><span class="hs-identifier hs-type">errPP</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224037"><span class="annot"><a href="#local-6989586621679224037"><span class="hs-identifier hs-type">errPreC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224038"><span class="annot"><a href="#local-6989586621679224038"><span class="hs-identifier hs-type">errPostC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224036"><span class="hs-identifier hs-type">errPP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224037"><span class="hs-identifier hs-type">errPreC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224038"><span class="hs-identifier hs-type">errPostC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier hs-type">TxFCEKCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224036"><span class="hs-identifier hs-type">errPP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224037"><span class="hs-identifier hs-type">errPreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224038"><span class="hs-identifier hs-type">errPostC</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TestTree</span></span><span>
</span><span id="line-304"></span><span id="txfCEKUnitCase"><span class="annot"><span class="annottext">txfCEKUnitCase :: forall errPP errPreC errPostC.
(Show errPP, Show errPreC, Show errPostC) =&gt;
TxFCEKCase errPP errPreC errPostC -&gt; TestTree
</span><a href="Cardano.TestUtils.html#txfCEKUnitCase"><span class="hs-identifier hs-var hs-var">txfCEKUnitCase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier hs-type">TxFCEKCase</span></a></span><span> </span><span id="local-6989586621679224403"><span class="annot"><span class="annottext">PipelinedTestCase errPP errPreC errPostC TxFCEKInput TxFCEKOutput
</span><a href="#local-6989586621679224403"><span class="hs-identifier hs-var">pipelinedCase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipelinedTestCase errPP errPreC errPostC TxFCEKInput TxFCEKOutput
-&gt; TestTree
forall errPP errPreC errPostC input output.
(Show errPP, Show errPreC, Show errPostC) =&gt;
PipelinedTestCase errPP errPreC errPostC input output -&gt; TestTree
</span><a href="Cardano.TestUtils.html#pipelinedUnitCase"><span class="hs-identifier hs-var">pipelinedUnitCase</span></a></span><span> </span><span class="annot"><span class="annottext">PipelinedTestCase errPP errPreC errPostC TxFCEKInput TxFCEKOutput
</span><a href="#local-6989586621679224403"><span class="hs-identifier hs-var">pipelinedCase</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- Nominal Case</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><span class="hs-comment">{- | A post condition for checking whether the script execution succeeded or failed
You must supply a way to turn a generic evaluation error into your domain-specific
error type
-}</span></span><span>
</span><span id="line-313"></span><span id="local-6989586621679224042"><span class="annot"><a href="Cardano.TestUtils.html#nominalPostCondition"><span class="hs-identifier hs-type">nominalPostCondition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvalError</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679224042"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-type">PostCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224042"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-type">TxFCEKOutput</span></a></span></span><span>
</span><span id="line-315"></span><span id="nominalPostCondition"><span class="annot"><span class="annottext">nominalPostCondition :: forall err.
((EvalError, [Text]) -&gt; err) -&gt; PostCondition err TxFCEKOutput
</span><a href="Cardano.TestUtils.html#nominalPostCondition"><span class="hs-identifier hs-var hs-var">nominalPostCondition</span></a></span></span><span> </span><span id="local-6989586621679224404"><span class="annot"><span class="annottext">(EvalError, [Text]) -&gt; err
</span><a href="#local-6989586621679224404"><span class="hs-identifier hs-var">toErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><span class="annottext">(TxFCEKOutput -&gt; Maybe err) -&gt; PostCondition err TxFCEKOutput
forall output err.
(output -&gt; Maybe err) -&gt; PostCondition err output
</span><a href="Cardano.TestUtils.html#mkPostCondition"><span class="hs-identifier hs-var">mkPostCondition</span></a></span><span> </span><span class="annot"><span class="annottext">((TxFCEKOutput -&gt; Maybe err) -&gt; PostCondition err TxFCEKOutput)
-&gt; (TxFCEKOutput -&gt; Maybe err) -&gt; PostCondition err TxFCEKOutput
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-type">TxFCEKOutput</span></a></span><span> </span><span id="local-6989586621679224405"><span class="annot"><span class="annottext">Either EvalError Script
</span><a href="#local-6989586621679224405"><span class="hs-identifier hs-var">eitherErrOrScript</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679224406"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224406"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either EvalError Script
</span><a href="#local-6989586621679224405"><span class="hs-identifier hs-var">eitherErrOrScript</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-318"></span><span>      </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679224407"><span class="annot"><span class="annottext">EvalError
</span><a href="#local-6989586621679224407"><span class="hs-identifier hs-var">evalErr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">err -&gt; Maybe err
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(err -&gt; Maybe err) -&gt; err -&gt; Maybe err
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(EvalError, [Text]) -&gt; err
</span><a href="#local-6989586621679224404"><span class="hs-identifier hs-var">toErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalError
</span><a href="#local-6989586621679224407"><span class="hs-identifier hs-var">evalErr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224406"><span class="hs-identifier hs-var">logs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Script
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe err
forall a. Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">{- | A basic nominal case unit test.
Only checks if the script succeeds; does not do pre-processing, pre-condition checking,
or other post-condition checks.

Throws a generic &quot;String&quot; error (not domain-specific)
-}</span></span><span>
</span><span id="line-327"></span><span class="annot"><a href="Cardano.TestUtils.html#nominalCaseBasic"><span class="hs-identifier hs-type">nominalCaseBasic</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Name of the test case</span></span><span>
</span><span id="line-329"></span><span>  </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-330"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Nominal context to apply Nominal</span></span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Nominal to apply</span></span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Script</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier hs-type">TxFCEKCase</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-335"></span><span id="nominalCaseBasic"><span class="annot"><span class="annottext">nominalCaseBasic :: String
-&gt; ScriptContext -&gt; Script -&gt; TxFCEKCase String String String
</span><a href="Cardano.TestUtils.html#nominalCaseBasic"><span class="hs-identifier hs-var hs-var">nominalCaseBasic</span></a></span></span><span> </span><span id="local-6989586621679224408"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679224408"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span id="local-6989586621679224409"><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679224409"><span class="hs-identifier hs-var">nominalCtx</span></a></span></span><span> </span><span id="local-6989586621679224410"><span class="annot"><span class="annottext">Script
</span><a href="#local-6989586621679224410"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><a href="#local-6989586621679224411"><span class="hs-identifier hs-type">errorPrinter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvalError</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621679224411"><span class="annot"><span class="annottext">errorPrinter :: (EvalError, [Text]) -&gt; String
</span><a href="#local-6989586621679224411"><span class="hs-identifier hs-var hs-var">errorPrinter</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679224412"><span class="annot"><span class="annottext">EvalError
</span><a href="#local-6989586621679224412"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679224413"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224413"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Script failed.\nEvaluation error: \n&quot;</span></span><span>
</span><span id="line-340"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">EvalError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">EvalError
</span><a href="#local-6989586621679224412"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n Trace Log: \n&quot;</span></span><span>
</span><span id="line-342"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.OldList.html#intercalate"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; [Text] -&gt; [String]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224413"><span class="hs-identifier hs-var">logs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>   </span><span class="hs-keyword">in</span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [PreProcessor String TxFCEKInput]
-&gt; [PreCondition String TxFCEKInput]
-&gt; TxFCEKInput
-&gt; [PostCondition String TxFCEKOutput]
-&gt; TxFCEKCase String String String
forall errPP errPreC errPostC.
String
-&gt; [PreProcessor errPP TxFCEKInput]
-&gt; [PreCondition errPreC TxFCEKInput]
-&gt; TxFCEKInput
-&gt; [PostCondition errPostC TxFCEKOutput]
-&gt; TxFCEKCase errPP errPreC errPostC
</span><a href="Cardano.TestUtils.html#mkTxFCEKCase"><span class="hs-identifier hs-var">mkTxFCEKCase</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679224408"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-346"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; Script -&gt; TxFCEKInput
</span><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-var">TxFCEKInput</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679224409"><span class="hs-identifier hs-var">nominalCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Script
</span><a href="#local-6989586621679224410"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">((EvalError, [Text]) -&gt; String)
-&gt; PostCondition String TxFCEKOutput
forall err.
((EvalError, [Text]) -&gt; err) -&gt; PostCondition err TxFCEKOutput
</span><a href="Cardano.TestUtils.html#nominalPostCondition"><span class="hs-identifier hs-var">nominalPostCondition</span></a></span><span> </span><span class="annot"><span class="annottext">(EvalError, [Text]) -&gt; String
</span><a href="#local-6989586621679224411"><span class="hs-identifier hs-var">errorPrinter</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><span class="hs-comment">{- | The attackCaseRegex-style functions will fail with
  - A (Nothing, [Text]) if the script succeeds. [Text] in the tuple contains the logs.
  - A (Just Int, [Text]) if the script fails, but the regex does not match exactly once.
    The int contains the number of matches
-}</span></span><span>
</span><span id="line-358"></span><span id="local-6989586621679224049"><span class="annot"><a href="Cardano.TestUtils.html#attackCaseRegexPostCondition"><span class="hs-identifier hs-type">attackCaseRegexPostCondition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-comment">-- | A way to go from the number of matches (if unequal to 1) and the logs to</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-comment">-- a domain-specific error</span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/text-2.0.2/src/Data.Text.Internal.html#Text"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679224049"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-comment">-- | The regular expression to match against. It must match exactly once</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-comment">-- for the post-condition check to pass</span><span>
</span><span id="line-364"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">RE</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PostCondition"><span class="hs-identifier hs-type">PostCondition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224049"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-type">TxFCEKOutput</span></a></span></span><span>
</span><span id="line-366"></span><span id="attackCaseRegexPostCondition"><span class="annot"><span class="annottext">attackCaseRegexPostCondition :: forall err.
((Maybe Int, [Text]) -&gt; err)
-&gt; RE -&gt; PostCondition err TxFCEKOutput
</span><a href="Cardano.TestUtils.html#attackCaseRegexPostCondition"><span class="hs-identifier hs-var hs-var">attackCaseRegexPostCondition</span></a></span></span><span> </span><span id="local-6989586621679224422"><span class="annot"><span class="annottext">(Maybe Int, [Text]) -&gt; err
</span><a href="#local-6989586621679224422"><span class="hs-identifier hs-var">toErr</span></a></span></span><span> </span><span id="local-6989586621679224423"><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679224423"><span class="hs-identifier hs-var">expectedFailureRE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><span class="annottext">(TxFCEKOutput -&gt; Maybe err) -&gt; PostCondition err TxFCEKOutput
forall output err.
(output -&gt; Maybe err) -&gt; PostCondition err output
</span><a href="Cardano.TestUtils.html#mkPostCondition"><span class="hs-identifier hs-var">mkPostCondition</span></a></span><span> </span><span class="annot"><span class="annottext">((TxFCEKOutput -&gt; Maybe err) -&gt; PostCondition err TxFCEKOutput)
-&gt; (TxFCEKOutput -&gt; Maybe err) -&gt; PostCondition err TxFCEKOutput
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKOutput"><span class="hs-identifier hs-type">TxFCEKOutput</span></a></span><span> </span><span id="local-6989586621679224424"><span class="annot"><span class="annottext">Either EvalError Script
</span><a href="#local-6989586621679224424"><span class="hs-identifier hs-var">eitherErrorOrScript</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679224425"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224425"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either EvalError Script
</span><a href="#local-6989586621679224424"><span class="hs-identifier hs-var">eitherErrorOrScript</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-369"></span><span>      </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679224426"><span class="annot"><span class="annottext">EvalError
</span><a href="#local-6989586621679224426"><span class="hs-identifier hs-var">_evalError</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-371"></span><span>          </span><span id="local-6989586621679224427"><span class="annot"><span class="annottext">numMatches :: Int
</span><a href="#local-6989586621679224427"><span class="hs-identifier hs-var hs-var">numMatches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matches Text -&gt; Int
forall a. Matches a -&gt; Int
</span><span class="hs-identifier hs-var">countMatches</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: Type -&gt; Type) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#fold"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224425"><span class="hs-identifier hs-var">logs</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; RE -&gt; Matches Text
</span><span class="hs-operator hs-var">*=~</span></span><span> </span><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679224423"><span class="hs-identifier hs-var">expectedFailureRE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>         </span><span class="hs-keyword">in</span><span>
</span><span id="line-373"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679224427"><span class="hs-identifier hs-var">numMatches</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-374"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe err
forall a. Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-375"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">err -&gt; Maybe err
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(err -&gt; Maybe err) -&gt; err -&gt; Maybe err
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int, [Text]) -&gt; err
</span><a href="#local-6989586621679224422"><span class="hs-identifier hs-var">toErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679224427"><span class="hs-identifier hs-var">numMatches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224425"><span class="hs-identifier hs-var">logs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>      </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Script
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><span class="annottext">err -&gt; Maybe err
forall a. a -&gt; Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(err -&gt; Maybe err) -&gt; err -&gt; Maybe err
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int, [Text]) -&gt; err
</span><a href="#local-6989586621679224422"><span class="hs-identifier hs-var">toErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224425"><span class="hs-identifier hs-var">logs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><span class="hs-comment">{- | Generate an &quot;attack case&quot; test tree, given a name, an expected failure condition,
the arguments to the script, an attack, and the script itself.

The expected failure condition is matched as a regex. It must match the logs exactly once.
-}</span></span><span>
</span><span id="line-384"></span><span id="local-6989586621679224055"><span class="annot"><a href="Cardano.TestUtils.html#attackCaseBasicRegex"><span class="hs-identifier hs-type">attackCaseBasicRegex</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-385"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Name of the test case</span></span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-comment">-- | Expected Failure String Match; TODO: This can be improved. Maybe use</span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-comment">-- a discriminated error sum type with a injective string mapping?</span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">RE</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Nominal context to apply attack</span></span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The script to execute</span></span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Script</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Attack to apply</span></span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#PreProcessor"><span class="hs-identifier hs-type">PreProcessor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224055"><span class="hs-identifier hs-type">errPP</span></a></span><span> </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-type">TxFCEKInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><a href="Cardano.TestUtils.html#TxFCEKCase"><span class="hs-identifier hs-type">TxFCEKCase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679224055"><span class="hs-identifier hs-type">errPP</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span></span><span>
</span><span id="line-397"></span><span id="attackCaseBasicRegex"><span class="annot"><span class="annottext">attackCaseBasicRegex :: forall errPP.
String
-&gt; RE
-&gt; ScriptContext
-&gt; Script
-&gt; PreProcessor errPP TxFCEKInput
-&gt; TxFCEKCase errPP String String
</span><a href="Cardano.TestUtils.html#attackCaseBasicRegex"><span class="hs-identifier hs-var hs-var">attackCaseBasicRegex</span></a></span></span><span> </span><span id="local-6989586621679224450"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679224450"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span id="local-6989586621679224451"><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679224451"><span class="hs-identifier hs-var">expectedFailureRE</span></a></span></span><span> </span><span id="local-6989586621679224452"><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679224452"><span class="hs-identifier hs-var">nominalCtx</span></a></span></span><span> </span><span id="local-6989586621679224453"><span class="annot"><span class="annottext">Script
</span><a href="#local-6989586621679224453"><span class="hs-identifier hs-var">script'</span></a></span></span><span> </span><span id="local-6989586621679224454"><span class="annot"><span class="annottext">PreProcessor errPP TxFCEKInput
</span><a href="#local-6989586621679224454"><span class="hs-identifier hs-var">attack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621679224455"><span class="annot"><span class="annottext">errorPrinter :: (Maybe Int, [Text]) -&gt; String
</span><a href="#local-6989586621679224455"><span class="hs-identifier hs-var hs-var">errorPrinter</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679224456"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224456"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-400"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Script Succeeded, but failure was expected. Logs: \n&quot;</span></span><span>
</span><span id="line-401"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.OldList.html#intercalate"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n    &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; [Text] -&gt; [String]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224456"><span class="hs-identifier hs-var">logs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><a href="#local-6989586621679224455"><span class="hs-identifier hs-var">errorPrinter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679224457"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679224457"><span class="hs-identifier hs-var">numMatches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679224458"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224458"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-403"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The script execution against the attack case failed, but without &quot;</span></span><span>
</span><span id="line-404"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;the expected error. The regex\n    &quot;</span></span><span>
</span><span id="line-405"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RE -&gt; String
</span><span class="hs-identifier hs-var">reSource</span></span><span> </span><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679224451"><span class="hs-identifier hs-var">expectedFailureRE</span></a></span><span>
</span><span id="line-406"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nshould have matched the logs exactly once, but it matched &quot;</span></span><span>
</span><span id="line-407"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679224457"><span class="hs-identifier hs-var">numMatches</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; times.&quot;</span></span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nLogs:\n    &quot;</span></span><span>
</span><span id="line-410"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.OldList.html#intercalate"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n    &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; [Text] -&gt; [String]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679224458"><span class="hs-identifier hs-var">logs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>   </span><span class="hs-keyword">in</span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; [PreProcessor errPP TxFCEKInput]
-&gt; [PreCondition String TxFCEKInput]
-&gt; TxFCEKInput
-&gt; [PostCondition String TxFCEKOutput]
-&gt; TxFCEKCase errPP String String
forall errPP errPreC errPostC.
String
-&gt; [PreProcessor errPP TxFCEKInput]
-&gt; [PreCondition errPreC TxFCEKInput]
-&gt; TxFCEKInput
-&gt; [PostCondition errPostC TxFCEKOutput]
-&gt; TxFCEKCase errPP errPreC errPostC
</span><a href="Cardano.TestUtils.html#mkTxFCEKCase"><span class="hs-identifier hs-var">mkTxFCEKCase</span></a></span><span>
</span><span id="line-413"></span><span>      </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679224450"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PreProcessor errPP TxFCEKInput
</span><a href="#local-6989586621679224454"><span class="hs-identifier hs-var">attack</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-415"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-416"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; Script -&gt; TxFCEKInput
</span><a href="Cardano.TestUtils.html#TxFCEKInput"><span class="hs-identifier hs-var">TxFCEKInput</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679224452"><span class="hs-identifier hs-var">nominalCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Script
</span><a href="#local-6989586621679224453"><span class="hs-identifier hs-var">script'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">((Maybe Int, [Text]) -&gt; String)
-&gt; RE -&gt; PostCondition String TxFCEKOutput
forall err.
((Maybe Int, [Text]) -&gt; err)
-&gt; RE -&gt; PostCondition err TxFCEKOutput
</span><a href="Cardano.TestUtils.html#attackCaseRegexPostCondition"><span class="hs-identifier hs-var">attackCaseRegexPostCondition</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int, [Text]) -&gt; String
</span><a href="#local-6989586621679224455"><span class="hs-identifier hs-var">errorPrinter</span></a></span><span> </span><span class="annot"><span class="annottext">RE
</span><a href="#local-6989586621679224451"><span class="hs-identifier hs-var">expectedFailureRE</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-418"></span></pre></body></html>